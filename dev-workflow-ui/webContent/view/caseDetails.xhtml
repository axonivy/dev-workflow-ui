<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:pm="http://primefaces.org/serenity-ivy" xmlns:jc="http://java.sun.com/jsf/composite/components">

<h:body>
  <f:metadata>
    <f:viewParam name="case" value="#{casesDetailsIvyDevWfBean.selectedCaseId}" />
  </f:metadata>

  <ui:composition template="../includes/template/template.xhtml">
    <ui:define name="content">
      <h:form id="form">
        <div class="layout-dashboard">
          <div class="p-grid">
            <div class="p-col-12 p-lg-8">
              <div class="card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-common-file-text"></i>
                    <h6 class="p-m-0">Description</h6>
                  </div>
                  <p:commandButton icon="si si-delete-1" styleClass="ui-button-danger rounded-button"
                    disabled="#{not casesDetailsIvyDevWfBean.canBeDestoryed()}" id="caseDestroyBtn"
                    actionListener="#{casesDetailsIvyDevWfBean.selectedCase.destroy}" update="@this, caseDetails, caseHierarchy" />
                </div>
                <ui:include src="/includes/components/caseDetails/description.xhtml" />
              </div>
            </div>

            <h:panelGroup styleClass="p-col-12 p-lg-4" layout="block" rendered="#{casesDetailsIvyDevWfBean.caseMap}">
              <div class="card casemap-card p-d-flex p-flex-column">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-information-circle"></i>
                    <h6 class="p-m-0">Case Map</h6>
                  </div>
                  <div class="straight-text-icon">
                    <h:panelGroup layout="block" rendered="#{not empty casesDetailsIvyDevWfBean.sidesteps}">
                      <p:commandButton value="Sidesteps" icon="si si-arrow-down-1" id="sidestepsBtn" />
                      <p:menu id="sidestepMenu" overlay="true" trigger="sidestepsBtn" my="right top" at="right bottom"
                        model="#{casesDetailsIvyDevWfBean.sidestepsMenuModel}" styleClass="menu-no-icons" />
                    </h:panelGroup>
                  </div>
                </div>
                <ui:include src="/includes/components/caseDetails/caseMap.xhtml" />
                <p:commandLink id="openCaseMapUiViewerBtn" styleClass="p-d-flex p-jc-center"
                  oncomplete="PF('process-viewer-dlg').show()" update="form:processViewer:processViewerDialog" actionListener="#{casesDetailsIvyDevWfBean.setViewerLink()}">
                  <h:outputText value="Open Case Map Viewer" />
                  <i class="p-ml-1 si si-expand-6" />
                </p:commandLink>
              </div>
            </h:panelGroup>

            <h:panelGroup styleClass="p-col-12 p-lg-4" layout="block" rendered="#{!casesDetailsIvyDevWfBean.caseMap}">
              <div class="card p-d-flex p-flex-column">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-information-circle"></i>
                    <h6 class="p-m-0">Process Viewer</h6>
                  </div>
                  <p:commandButton id="openProcessViewerBtn" icon="si si-expand-6"
                    styleClass="ui-button-secondary rounded-button" onclick="PF('process-viewer-dlg').show()"/>
                </div>
                <div class="height-100 p-d-flex p-jc-center p-ai-center">
                  <iframe id="processViewerFrame" src="#{casesDetailsIvyDevWfBean.processPreviewLink}"/>
                </div>
              </div>
            </h:panelGroup>

            <div class="p-col-12 p-lg-8">
              <div class="card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-layout-bullets"></i>
                    <h6 class="p-m-0">Task list</h6>
                  </div>
                  <h:panelGroup id="switchContainer" styleClass="p-d-inline-flex p-ai-center">
                    <h:outputText value="Show system tasks" class="p-mr-2" />
                    <p:toggleSwitch id="showSystemTasksSwitch" value="#{casesDetailsIvyDevWfBean.showSystemTasks}">
                      <p:ajax update="form:tasks" />
                    </p:toggleSwitch>
                  </h:panelGroup>
                </div>
                <ui:include src="/includes/components/caseDetails/taskList.xhtml" />
              </div>
            </div>

            <div class="p-col-12 p-lg-4">
              <div class="card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-task-list-approve"></i>
                    <h6 class="p-m-0">Case hierarchy</h6>
                  </div>
                </div>
                <ui:include src="/includes/components/caseDetails/caseList.xhtml" />
              </div>
            </div>

            <div class="p-col-12 p-lg-8">
              <div class="card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-cog"></i>
                    <h6 class="p-m-0">Custom fields</h6>
                  </div>
                </div>
                <jc:customFields id="customFields" customFields="#{casesDetailsIvyDevWfBean.customFields}" />
              </div>
            </div>

            <div class="p-col-12 p-lg-4">
              <div class="card documents-card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-office-file-doc-1"></i>
                    <h6 class="p-m-0">Documents</h6>
                  </div>
                </div>
                <ui:include src="/includes/components/caseDetails/documents.xhtml" />
              </div>
            </div>

            <div class="p-col-12">
              <div class="card">
                <div class="card-header">
                  <div class="card-title p-d-flex p-ai-center">
                    <i class="p-pr-3 si si-synchronize-arrow-clock"></i>
                    <h6 class="p-m-0">Workflow Events</h6>
                  </div>
                </div>
                <jc:workflowEventsTable id="workflowEvents" workflowEvents="#{casesDetailsIvyDevWfBean.workflowEvents}" />
              </div>
            </div>
          </div>
        </div>

        <jc:processViewer id="processViewer" title="#{casesDetailsIvyDevWfBean.viewerDialogTitle}" link="#{casesDetailsIvyDevWfBean.viewerLink}" />
      </h:form>
    </ui:define>
  </ui:composition>
</h:body>

</html>
