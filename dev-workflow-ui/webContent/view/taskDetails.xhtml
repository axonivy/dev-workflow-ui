<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:pm="http://primefaces.org/serenity-ivy" xmlns:jc="http://java.sun.com/jsf/composite/components">

<h:body>
  <f:metadata>
    <f:viewParam name="task" value="#{tasksDetailsIvyDevWfBean.selectedTaskId}" />
  </f:metadata>

  <ui:composition template="../includes/template/template.xhtml">
    <ui:define name="content">
      <f:event type="preRenderView" listener="#{tasksDetailsIvyDevWfBean.redirectIfCantResume}" />

      <h:form id="form">
        <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank grid-smaller-padding"
          columnClasses="ui-g-12">
          <h:panelGroup styleClass="card card-w-title custom-card" layout="block">
            <div class="detail-card-header">
              <div class="detail-card-title">
                <i class="si si-lg si-common-file-text detail-title-icon" />
                <h:outputText value="Description" />
              </div>
              <ui:include src="/includes/components/taskDetails/descriptionCardHeaderActions.xhtml" />
            </div>
            <p:separator />
            <ui:include src="/includes/components/taskDetails/description.xhtml" />
          </h:panelGroup>

          <h:panelGroup styleClass="card card-w-title custom-card" layout="block">
            <h:panelGroup layout="block" styleClass="detail-card-title related-element">
              <i class="si si-lg si-cog detail-title-icon" />
              <h:outputText value="Custom fields" />
            </h:panelGroup>
            <jc:customFields id="customFields" customFields="#{tasksDetailsIvyDevWfBean.selectedTask.customFields}" />
          </h:panelGroup>

          <h:panelGroup styleClass="card card-w-title custom-card" layout="block">
            <div class="detail-card-title">
              <i class="si si-lg si-synchronize-arrow-clock detail-title-icon" />
              <h:outputText value="Workflow Events" />
            </div>
            <jc:workflowEventsTable id="workflowEvents" workflowEvents="#{tasksDetailsIvyDevWfBean.selectedTask.workflowEvents}"/>
          </h:panelGroup>

        </p:panelGrid>

        <p:dialog id="processViewerDialog" widgetVar="process-viewer-dlg" width="80%" showEffect="fade" modal="true"
          style="margin-top: 6em">
          <f:facet name="header">
            <h:outputText value="Process of: #{tasksDetailsIvyDevWfBean.selectedTask.name}" styleClass="margin-right-10" />
            <p:link id="openViewerNewPage" styleClass="staight-text-icon" href="#{tasksDetailsIvyDevWfBean.selectedTask.viewerLink}">
              <i class="si si-expand-6" style="font-size: 0.75em" />
            </p:link>
          </f:facet>
          <iframe id="iFrame" src="#{tasksDetailsIvyDevWfBean.viewerLink}"
            style="height: calc(100vh - 195px); width: 100%; border: 0;" />
        </p:dialog>

      </h:form>

      <p:dialog header="Delegate task" id="delegateTaskDialog" widgetVar="delegateTaskModal" modal="true" height="150" width="400">
        <h:form id="delegateTaskForm">
          <h:outputText value="Delegate the task to a specified user or group"/>
          <h:panelGroup id="delegateElements" layout="block">
            <p:selectOneRadio value="#{tasksDetailsIvyDevWfBean.showUsers}" layout="responsive"
              columns="2" styleClass="margin-top-10">
              <f:selectItem itemLabel="User" itemValue="true"/>
              <f:selectItem itemLabel="Role" itemValue="false"/>
              <p:ajax update="delegateElements" event="valueChange"/>
            </p:selectOneRadio>
            <p:selectOneMenu styleClass="margin-top-10 width-100" value="#{tasksDetailsIvyDevWfBean.delegateMember}"
              rendered="#{tasksDetailsIvyDevWfBean.showUsers}" id="selectUserMenu" immediate="true">
              <f:selectItems value="#{tasksDetailsIvyDevWfBean.allUsers}" var="member" itemLabel="#{member.displayName}" itemValue="#{member.memberName}"/>
            </p:selectOneMenu>
            <p:selectOneMenu styleClass="margin-top-10 width-100" value="#{tasksDetailsIvyDevWfBean.delegateMember}"
              rendered="#{!tasksDetailsIvyDevWfBean.showUsers}" id="selectRoleMenu" immediate="true">
              <f:selectItems value="#{tasksDetailsIvyDevWfBean.allRoles}" var="member" itemLabel="#{member.displayName}" itemValue="#{member.memberName}"/>
            </p:selectOneMenu>
          </h:panelGroup>
          <h:panelGroup layout="block" styleClass="dialog-button-container">
            <p:commandLink value="Cancel" styleClass="dialog-cancel-button" onclick="PF('delegateTaskModal').hide();"/>
            <p:commandButton id="delegateProceedButton" value="Assign task"
              actionListener="#{tasksDetailsIvyDevWfBean.delegateTask}" icon="si si-move-to-bottom"
              update="form" onsuccess="PF('delegateTaskModal').hide();"/>
          </h:panelGroup>
        </h:form>
      </p:dialog>

    </ui:define>
  </ui:composition>
</h:body>

</html>
