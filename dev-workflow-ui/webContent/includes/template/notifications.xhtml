<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">

<p:commandLink id="showNotifications" rendered="#{loginIvyDevWfBean.loggedIn}">
  <i class="topbar-icon pi pi-bell"/>
  <div class="notification-badge">
    <h:outputText id="unreadNotifications" value="#{notificationBean.unreadNotifications}" />
  </div>
</p:commandLink>

<p:overlayPanel for="showNotifications" style="width:350px" rendered="#{loginIvyDevWfBean.loggedIn}">
  <h:panelGroup id="notifications">
    <div class="p-d-flex p-jc-between">
      <h6>Notifications</h6>

      <div class="p-d-flex">
        <p:commandLink id="notificationMarkAllAsRead" rendered="#{notificationBean.hasUnreadNotifications()}" actionListener="#{notificationBean.readAll()}" update="notifications unreadNotifications">
          <i class="notification-button si si-check-double-1 p-mr-1" />
        </p:commandLink>
        <p:tooltip for="notificationMarkAllAsRead" value="Mark all notifications as read" />

        <p:commandLink id="notificationHideAll" rendered="#{notificationBean.hasNotifications()}" actionListener="#{notificationBean.hideAll()}" update="notifications unreadNotifications">
          <i class="notification-button si si-bin-1" />
        </p:commandLink>
        <p:tooltip for="notificationHideAll" value="Delete all notifications" />
      </div>
    </div>

    <h:panelGroup id="no-notifications" rendered="#{!notificationBean.hasNotifications()}">
      <div class="p-text-center" style="padding:20px;">No Notifications </div>
    </h:panelGroup>

    <h:panelGroup rendered="#{notificationBean.hasNotifications()}">
      <h:form id="notificationForm">
        <p:dataScroller id="notifications" lazy="true" styleClass="notification-scroll" value="#{notificationBean.dataModel}" var="notification" chunkSize="20" mode="inline">
          <div class="#{notification.style} notification-container">
            <div class="p-d-flex p-jc-between">
              <h:outputLink id="notificationMessage" value="#{notification.infoLink}" styleClass="notification-message">
                <h:outputText value="#{notification.message}"/>
              </h:outputLink>
              <p:tooltip for="notificationMessage" value="Info" />

              <div class="p-d-flex notification-action-container">
                <h:outputLink id="notificationRunAction" value="#{notification.runLink}" rendered="#{notification.runnable}">
                  <i class="notification-action si si-controls-play p-mr-1 " />
                </h:outputLink>
                <p:tooltip for="notificationRunAction" value="Run" />
                <p:commandLink id="notificationMarkAsRead" process="@this" rendered="#{!notification.read}" actionListener="#{notificationBean.markAsRead(notification)}" update="notifications unreadNotifications">
                  <i class="notification-action si si-check-circle-1 p-mr-1 " />
                </p:commandLink>
                <p:tooltip for="notificationMarkAsRead" value="Mark as read" />
              </div>
            </div>

            <div>
              <h:outputText value="#{notification.createdAt}" style="font-size: 0.75em;">
                <f:convertDateTime type="both" dateStyle="medium" timeStyle="short" />
              </h:outputText>
            </div>
          </div>
        </p:dataScroller>
      </h:form>
    </h:panelGroup>
  </h:panelGroup>
</p:overlayPanel>

</ui:composition>
