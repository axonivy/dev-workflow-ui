<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions">
  <f:event type="preRenderView" listener="#{tasksBean.checkIfLoggedIn}"/>
  <h:form id="tasksForm" style="margin-top: 20px">
    <h:outputText value="All Tasks" style="font-size:16pt; font-weight:bold" />
    <p:dataTable id="tasks" var="task" value="#{tasksBean.getTasks()}" widgetVar="tasksTable"
      emptyMessage="No Tasks found with given criteria" style="margin-top:10px">

      <f:facet name="header">
        <p:outputPanel>
          <h:outputText value="Search:" />
          <p:inputText id="globalFilter" onkeyup="PF('tasksTable').filter()" style="width:150px"
            placeholder="Enter keyword" />
        </p:outputPanel>
      </f:facet>

      <p:column filterBy="#{task.getPriority()}" styleClass="icon-row">
        <i class="material-icons"><h:outputText id="taskPriority"
            value="#{tasksBean.getPriorityIcon(task.getPriority())}" /></i>
        <p:tooltip for="taskPriority" value="Priority #{task.getPriority()}" position="top" />
      </p:column>

      <p:column filterBy="#{task.getState()}" styleClass="icon-row">
        <i class="material-icons"><h:outputText id="taskState" value="#{tasksBean.getStateIcon(task.getState())}" /></i>
        <p:tooltip for="taskState" value="State #{task.getState()}" position="top" />
      </p:column>

      <p:column headerText="Name" filterBy="#{task.getName()}">
        <h:outputText id="taskName" value="#{task.getName()}" />
        <p:tooltip for="taskName" value="Task ID: #{task.getId()}" position="top" />
      </p:column>

      <p:column headerText="Responsible" filterBy="#{task.getActivator()}">
        <h:outputText value="#{task.getActivator().getName()}" />
      </p:column>

      <p:column headerText="Start Date" style="text-align: center;">
        <h:outputText value="#{tasksBean.getPrettyTime(task.getStartTimestamp())}" />
      </p:column>

      <p:column headerText="Expiry" style="text-align: center;">
        <h:outputText value="#{task.getExpiryTimestamp()}" />
      </p:column>

      <p:column style="width: 60px; text-align: center;">
        <h:link outcome="taskDetails">
          <f:param name="task" value="#{task.getId()}" />
          <i class="material-icons">info_outline</i>
        </h:link>
      </p:column>
    </p:dataTable>
  </h:form>
</ui:composition>
