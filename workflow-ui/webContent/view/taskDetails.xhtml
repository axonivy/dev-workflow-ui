<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:pm="http://primefaces.org/serenity-ivy">

<h:body>
  <f:metadata>
    <f:viewParam name="task" value="#{tasksDetailsBean.selectedTaskId}" />
  </f:metadata>

  <ui:composition template="../includes/template/template.xhtml">
    <ui:define name="content">

      <div class="card card-w-title" style="margin: auto">
        <h:form id="form">
          <div class="task-detail-title straight-text-icon">
            <i class="si si-lg si-single-neutral-actions" style="padding-right: 6px"></i>
            <h:outputText value="Description" />
            <div class="task-detail-action-container action-container">
              <p:commandLink value="Start" action="#{tasksBean.executeTask(tasksDetailsBean.getSelectedTask().getId())}" class="task-action-item straight-text-icon" id="taskStartBtn">
                <i class="si si-arrow-right-1" style="padding-left: 4px; font-weight: 800;"></i>
              </p:commandLink>
              <p:commandLink value="Actions" class="task-actions-link straight-text-icon" id="taskActionsBtn">
                <i class="si si-arrow-down-1" style="padding-left: 4px"></i>
              </p:commandLink>
              <p:menu id="actionsMenu" overlay="true" trigger="taskActionsBtn" my="right top" at="right bottom">
                <p:menuitem actionListener="#{tasksDetailsBean.selectedTask.reset()}" update="form"
                  disabled="#{!tasksDetailsBean.canReset()}" id="taskResetBtn">
                  <i class="si si-road-sign-u-turn-left table-icon"></i>Reset
                </p:menuitem>
                <p:menuitem actionListener="#{tasksDetailsBean.park()}" update="form"
                  disabled="#{!tasksDetailsBean.canPark()}" id="taskParkBtn">
                  <i class="si si-road-sign-u-turn-right table-icon"></i>Park
                </p:menuitem>
                <p:menuitem actionListener="#{tasksDetailsBean.selectedTask.destroy()}" update="form"
                  disabled="#{!tasksDetailsBean.selectedTask.getState().isActive()}"  id="taskDestoryBtn">
                  <i class="si si-close table-icon"></i>Destroy
                </p:menuitem>
                <p:menuitem actionListener="#{tasksDetailsBean.expireTask}" update="form"
                  disabled="#{!tasksDetailsBean.selectedTask.getState().isActive()}"
                  rendered="#{engineModeBean.demoOrDesigner}" id="taskExpireBtn">
                  <i class="si si-alarm-bell-timer table-icon"></i>Expire now
                </p:menuitem>
              </p:menu>
            </div>
          </div>
          <span>
            <p:panelGrid id="taskDetails" columns="2" layout="grid" style="padding-bottom:60px"
              columnClasses="ui-g-3 no-padding-left, ui-g-9" styleClass="ui-noborder">
              <h:outputText value="Task ID:" />
              <h:outputText value="#{tasksDetailsBean.selectedTask.getId()}" />

              <h:outputText value="Task name:" />
              <h:outputText value="#{tasksDetailsBean.selectedTask.getName()}" id="taskName"/>

              <h:outputText value="Priority:" />
              <h:outputText>
                <i class="si si-#{tasksBean.getPriorityIcon(tasksDetailsBean.selectedTask.getPriority())} table-icon"></i>
                <h:outputText value="#{tasksDetailsBean.selectedTask.getPriority()}" id="taskPriority" />
              </h:outputText>

              <h:outputText value="State:" />
              <h:outputText>
                <i class="si si-#{tasksBean.getStateIcon(tasksDetailsBean.selectedTask.getState())} table-icon"></i>
                <h:outputText value="#{tasksDetailsBean.selectedTask.getState()}" id="taskState" />
              </h:outputText>

              <h:outputText value="Business case:" />
              <h:link id="businessCase" value="#{tasksDetailsBean.getBusinessCaseName()}" outcome="caseDetails">
                <f:param name="case" value="#{tasksDetailsBean.getBusinessCaseId()}" />
              </h:link>

              <h:outputText value="Technical case:" />
              <h:link id="technicalCase" value="##{tasksDetailsBean.selectedTask.getCase().getId()}"
                outcome="caseDetails">
                <f:param name="case" value="#{tasksDetailsBean.selectedTask.getCase().getId()}" />
              </h:link>

              <h:outputText value="Working user:" />
              <h:outputText value="#{tasksDetailsBean.getWorkingUser()}" id="workingUser"/>

              <h:outputText value="Responsible:" />
              <h:outputText value="#{tasksDetailsBean.selectedTask.getActivator().getDisplayName()}" id="taskResponsible"/>

              <h:outputText value="Created:" />
              <h:outputText value="#{tasksDetailsBean.getDateTime(tasksDetailsBean.selectedTask.getStartTimestamp())}" id="createdDate"/>

              <h:outputText value="Expiry:" />
              <h:outputText
                value="#{tasksDetailsBean.getDetailTime(tasksDetailsBean.selectedTask.getExpiryTimestamp())}" id="expiryDate"/>

              <h:outputText value="Completed on:" />
              <h:outputText value="#{tasksDetailsBean.getDetailTime(tasksDetailsBean.selectedTask.getEndTimestamp())}" id="completedDate"/>

              <h:outputText value="Workflow Events:" />
              <p:commandLink value="Open" onclick="PF('workflowDialog').show()" id="workflowEventsBtn"/>

              <h:outputText value="Description:" />
              <h:outputText value="#{tasksDetailsBean.getDescription()}" id="taskDescription"/>
            </p:panelGrid>
            <p:tooltip for="businessCase" value="#{tasksDetailsBean.getBusinessCaseTooltip()}" position="top" />
            <p:tooltip for="technicalCase" value="#{tasksDetailsBean.getTechnicalCaseTooltip()}" position="top" />
            <ui:include src="/includes/components/workflowEventsDialog.xhtml" />
          </span>
        </h:form>
      </div>
    </ui:define>
  </ui:composition>
</h:body>

</html>
